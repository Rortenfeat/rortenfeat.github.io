<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>文案复制</title>
		<script>
			window.onload = ()=>{
				let submit = document.getElementById('submit');
				let api = 'https://service-fcwre3vn-1302238762.sh.apigw.tencentcs.com/release/api-copy'
				let xhr = new XMLHttpRequest();
				xhr.onreadystatechange = function(){
					if ( this.readyState == 4 && this.status == 200 ) {
						if ( this.status == 200 ) {
							resp = JSON.parse(this.responseText);
							console.log(resp);
							if ( resp.success == true ) {
								let before = document.getElementById('before');
								let after = document.getElementById('after');
								let desc = document.getElementById('desc');
								let cover = document.getElementById('cover');
								before.style.display = 'none';
								after.style.display = 'flex';
								desc.value = resp.desc;
								cover.src = resp.cover;
							} else if ( resp.info ) {
								alert(resp.info);
							}
						} else {
							alert('解析失败');
						}
					}
				}
				submit.onclick = ()=>{
					let rule = /(?:https?:\/\/)?(?:(?:xhslink\.com\/[a-zA-Z0-9]+)|(?:(?:www\.)?xiaohongshu\.com\/discovery\/item\/[0-9a-zA-Z=-_&\?]+))/i;
					let input = document.getElementById('url').value;
					if ( rule.exec(input) !== null ) {
						let url = rule.exec(input);
						console.log(url);
						xhr.open('GET', `${api}?url=${url[0]}`, true);
						xhr.send();
					} else {
						alert('没有匹配的链接')
					}
					return false;
				}
			}
		</script>
		<style>
			html, body {
				width: 100%;
				height: 100%;
				overflow: hidden;
				background-color: rgb(248, 241, 232);
			}
			form#before {
				display: flex;
			}
			form {
				height: 85%;
				padding: 50px;
				flex-direction: column;
				justify-content: center;
			}
			div {
				display: flex;
				margin: 20px;
			}
			div.a {
				height: 100px;
				flex-grow: 3;
			}
			div.b {
				height: 40px;
				flex-grow: 1;
				flex-shrink: 0;
			}
			div.c, div.d {
				height: 70px;
				flex-grow: 1;
			}
			div.d {
				flex-direction: row;
				justify-content: center;
				background-color: rgb(238, 229, 219);
			}
			button, textarea {
				display: inline-block;
				width: 100%;
				vertical-align: center;
				font-size: 4vw;
				background-color: rgb(238, 229, 219);
			}
			textarea {
				text-align: left;
				resize: none;
			}
			button {
				text-align: center;
			}
		</style>
	</head>
	<body>
		<form id='before'>
			<div class='a'>
				<textarea id='url' placeholder='在这里粘贴链接……'></textarea>
			</div>
			<div class='b'>
				<button id='submit'>解析</button>
			</div>
		</form>
		<form id='after' style='display: none;'>
			<div class='c'>
				<textarea id='desc' placeholder='这里是解析的文案……'></textarea>
			</div>
			<div class='d'>
				<img id='cover'/>
			</div>
		</form>
	</body>
</html>